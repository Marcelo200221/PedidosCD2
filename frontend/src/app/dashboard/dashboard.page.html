<body>
  <ion-content class="login-page" fullscreen>

  <div class="login-header">
    <div class="barra-superior">
      <div class="top-row">
        <ion-icon name="menu" class="icon-left" (click)="toggleMenu()"></ion-icon>
        <h1 class="titulo-texto">Dashboard</h1>
      </div>
    </div>
  </div>
      <!-- Overlay del menú -->
  <div class="menu-overlay" *ngIf="menuAbierto" (click)="cerrarMenu()"></div>

  <!-- Menú lateral -->
  <div class="menu-lateral" [class.abierto]="menuAbierto">
    <div class="menu-header">
      <div class="menu-user-info">
        <p>Bienvenido,</p><p class="user-name" *ngIf="nombreUsuario">{{ nombreUsuario }} {{ apellidoUsuario }}</p>
      </div>
      <ion-icon name="close" class="icon-cerrar-menu" (click)="cerrarMenu()"></ion-icon>
    </div>
    
    <div class="menu-contenido">
      <div class="menu-item" (click)="Irapedidosmenu()">
        <ion-icon name="cube"></ion-icon>
        <span>Pedidos</span>
      </div>
      
      <div class="menu-item" (click)="Irafacturasmenu()">
        <ion-icon name="document-text"></ion-icon>
        <span>Facturas</span>
      </div>
      
      <div class="menu-item" (click)="Iradashboardsmenu()">
        <ion-icon name="bar-chart"></ion-icon>
        <span>Dashboards</span>
      </div>
      
      <div class="menu-divider"></div>
      
     <div class="menu-item" (click)="IrMenu()">
        <ion-icon name="arrow-undo"></ion-icon>
        <span>Volver al Menu</span>
      </div>

      <div class="menu-item" (click)="cerrarSesion()">
        <ion-icon name="log-out"></ion-icon>
        <span>Cerrar Sesión</span>
      </div>

    </div>
  </div>

  <div class="contenido">
  <!-- Spinner de carga -->
    <div *ngIf="cargando" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando estadísticas...</p>
    </div>

    <!-- Contenido del dashboard -->
    <div *ngIf="!cargando">

      <!-- Tarjeta de resumen -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Estado de Pedidos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="resumen-total">
            <div class="grafico-torta">
              <svg viewBox="0 0 400 400" class="pie-chart">

                <!-- Círculo base -->
                <circle cx="200" cy="200" r="150" fill="#f5f5f5"/>

                <!-- Segmentos del gráfico -->
                <g *ngFor="let stat of estadisticas; let i = index">
                  <path 
                    [attr.d]="calcularSegmento(i)" 
                    [attr.fill]="stat.color"
                    class="pie-segment"
                    [attr.data-porcentaje]="stat.porcentaje"
                  />
                </g>

                <!-- Círculo central para efecto dona (opcional) -->
                <circle cx="200" cy="200" r="80" fill="white"/>

                <!-- Texto central -->
                <text x="200" y="195" text-anchor="middle" class="pie-center-text">
                  Total
                </text>
                <text x="200" y="220" text-anchor="middle" class="pie-center-number">
                  {{ totalPedidos }}
                </text>
              </svg>
            </div>
          </div>

          <div class="estadisticas-lista">
            <div 
              *ngFor="let stat of estadisticas" 
              class="estadistica-item"
              [style.border-left]="'4px solid ' + stat.color">
              <div class="estadistica-info">
                <div class="estadistica-header">
                  <span class="estadistica-nombre">{{ stat.estado }}</span>
                  <span class="estadistica-porcentaje">{{ stat.porcentaje }}%</span>
                </div>
                <div class="estadistica-barra">
                  <div 
                    class="estadistica-progreso" 
                    [style.width.%]="stat.porcentaje"
                    [style.background-color]="stat.color">
                  </div>
                </div>
                <span class="estadistica-cantidad">{{ stat.cantidad }} pedido(s)</span>
              </div>
            </div>
          </div>

        </ion-card-content>
      </ion-card>
    </div>
  </div>

</ion-content>
</body>
