<ion-content class="productos-page">
  <div class="login-header">
    <div class="barra-superior">
      <div class="top-row">
        <ion-icon name="menu" class="icon-left" (click)="toggleMenu()"></ion-icon>
        <h1 class="titulo-texto">Productos</h1>
      </div>
    </div>
  </div>

  <!-- Pestañas de navegación -->
  <div class="tabs-container">
    <div class="tab" [class.active]="editPrecio && !editStock" (click)="editarPrecio()">
      <span>Precios</span>
    </div>
    <div class="tab" [class.active]="editStock && !editPrecio" (click)="editarStock()">
      <span>Stock</span>
    </div>
  </div>

  <!-- Lista de productos -->
  <div class="lista-productos">
    <ion-list>
      <ion-item class="producto-item" lines="none" *ngFor="let p of productos">
        <div class="producto-card">
          <div class="producto-info">
            <div class="producto-nombre">{{ p.nombre }}</div>
            
            <!-- Mostrar precio -->
            <div *ngIf="editPrecio && !editStock" class="producto-detalle">
              <span class="label">Precio actual:</span>
              <span class="valor">{{ p.precio | number:'1.0-0' }} CLP</span>
            </div>
            
            <!-- Mostrar stock -->
            <div *ngIf="editStock && !editPrecio" class="producto-detalle">
              <span class="label">Stock actual:</span>
              <span class="valor valor-stock" [class.stock-bajo]="p.stock < 10">{{ p.stock | number:'1.0-0' }} unidades</span>
            </div>
          </div>

          <!-- Botón de edición -->
          <div *ngIf="editProductos" class="acciones">
            <ion-button *ngIf="editPrecio && !editStock" class="btn-editar" (click)="abrirModal(p)"> 
            <ion-icon name="create"></ion-icon>
            </ion-button>
            
            <ion-button *ngIf="!editPrecio && editStock" class="btn-editar" (click)="abrirModalStock(p)">
              <ion-icon name="create"></ion-icon>
            </ion-button>
          </div>
        </div>
      </ion-item>
    </ion-list>
  </div>

  <!-- Modal de Precio -->
  <div class="modal-backdrop" *ngIf="mostrarModal && editPrecio && !editStock" (click)="cerrarModal()"></div>
  <div class="modal" *ngIf="mostrarModal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Cambiar precio</h3>
      <ion-icon name="close" class="close-icon" (click)="cerrarModal()"></ion-icon>
    </div>
    <div class="modal-body">
      <p class="producto-modal-nombre" *ngIf="productoSeleccionado">{{ productoSeleccionado.nombre }}</p>
      <p class="precio-actual-info" *ngIf="productoSeleccionado">
        Precio actual: <strong>{{ productoSeleccionado.precio | number:'1.0-0' }} CLP</strong>
      </p>
      <ion-item lines="none">
        <ion-label position="stacked">Nuevo precio (CLP)</ion-label>
        <ion-input type="number" [(ngModel)]="nuevoPrecio" placeholder="Ingrese el nuevo precio"></ion-input>
      </ion-item>
    </div>
    <div class="modal-actions">
      <ion-button class="btn-cancelar" fill="clear" (click)="cerrarModal()">Cancelar</ion-button>
      <ion-button class="btn-guardar" (click)="confirmarCambio()">Guardar</ion-button>
    </div>
  </div>

  <!-- Modal de Stock -->
  <div class="modal-backdrop" *ngIf="mostrarModalStock && !editPrecio && editStock" (click)="cerrarModalStock()"></div>
  <div class="modal" *ngIf="mostrarModalStock" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Cambiar stock</h3>
      <ion-icon name="close" class="close-icon" (click)="cerrarModalStock()"></ion-icon>
    </div>
    <div class="modal-body">
      <p class="producto-modal-nombre" *ngIf="productoSeleccionado">{{ productoSeleccionado.nombre }}</p>
      <p class="precio-actual-info" *ngIf="productoSeleccionado">
        Stock actual: <strong>{{ productoSeleccionado.stock | number:'1.0-0' }} unidades</strong>
      </p>
      <ion-item lines="none">
        <ion-label position="stacked">Nuevo stock</ion-label>
        <ion-input type="number" [(ngModel)]="nuevoStock" placeholder="Ingrese el nuevo stock"></ion-input>
      </ion-item>
    </div>
    <div class="modal-actions">
      <ion-button class="btn-cancelar" fill="clear" (click)="cerrarModalStock()">Cancelar</ion-button>
      <ion-button class="btn-guardar" (click)="confirmarCambioStock()">Guardar</ion-button>
    </div>
  </div>

  <!-- Overlay del menú -->
  <div class="menu-overlay" *ngIf="menuAbierto" (click)="cerrarMenu()"></div>

  <!-- Menú lateral -->
  <div class="menu-lateral" [class.abierto]="menuAbierto">
    <div class="menu-header">
      <div class="menu-user-info">
        <p>Bienvenido,</p><p class="user-name" *ngIf="nombreUsuario">{{ nombreUsuario }} {{ apellidoUsuario }}</p>
      </div>
      <ion-icon name="close" class="icon-cerrar-menu" (click)="cerrarMenu()"></ion-icon>
    </div>
    
    <div class="menu-contenido">
      <div class="menu-item" (click)="IrAPerfil()">
        <ion-icon name="person"></ion-icon>
        <span>Perfil</span>
      </div>
      <div class="menu-divider"></div>
      <div class="menu-item" (click)="Irapedidosmenu()">
        <ion-icon name="cube"></ion-icon>
        <span>Pedidos</span>
      </div>
      
      <div class="menu-item" (click)="Irafacturasmenu()">
        <ion-icon name="document-text"></ion-icon>
        <span>Facturas</span>
      </div>
      
      <div class="menu-item" (click)="Iradashboardsmenu()">
        <ion-icon name="bar-chart"></ion-icon>
        <span>Dashboards</span>
      </div>

      <div class="menu-divider"></div>

      <div class="menu-item" (click)="IrAUsuarios()">
        <ion-icon name="person"></ion-icon>
        <span>Usuarios</span>
      </div>
      
      <div class="menu-item" (click)="IrListarClientes()">
        <ion-icon name="people"></ion-icon>
        <span>Clientes</span>
      </div>

      <div class="menu-item" (click)="IraProductos()">
        <ion-icon name="bag"></ion-icon>
        <span>Productos</span>
      </div>

      <div class="menu-divider"></div>

      <div class="menu-item" (click)="IrMenu()">
        <ion-icon name="arrow-undo"></ion-icon>
        <span>Volver al Menu</span>
      </div>
      
      <div class="menu-item" (click)="cerrarSesion()">
        <ion-icon name="log-out"></ion-icon>
        <span>Cerrar Sesión</span>
      </div>
    </div>
  </div>
</ion-content>